(this.webpackChunkzoom=this.webpackChunkzoom||[]).push([[716],{75456:function(e,t,n){!function(e,t){"use strict";const s={ZOOM_IQ_EXT:"zoom:iq:ext",ZOOM_IQ_PRESENCE:"zoom:iq:presence",CHATSTATES:"http://jabber.org/protocol/chatstates",IQ_PRIVATE:"jabber:iq:private",JABBER_CLIENT:"jabber:client",ZOOM_IQ_RECENTCHAT:"zoom:iq:recentchat",tempPresence:"zoom:iq:temp_presence",notify:"zoom:iq:notify",snooze:"zoom:notify:snooze",ZOOM_IQ_ROOM:"zoom:iq:room",ZOOM_IQ_GROUP:"zoom:iq:group",ZOOM_IQ_VERSION:"zoom:iq:version",URN_XMPP_BLOCKING:"urn:xmpp:blocking",VCARD_TEMP:"vcard-temp",STARSESSION:"zoom:iq:starsession"},o=e=>{if(!e)return[];let t=[];return Array.isArray(e)?t=e.map(e=>({resource:e["@resource"],show:e["@show"],status:e["@status"]})):e["@resource"]&&(t=[{resource:e["@resource"],show:e["@show"],status:e["@status"]}]),t};var i,r;let c,a;var l,d,u;t.Strophe.addConnectionPlugin("iqpresence",{_c:null,_iqPresecnceCb:null,_deviceCb:null,_unreadChatMessageCb:null,init:function(e){this._c=e},statusChanged:function(e){e!==t.Strophe.Status.CONNECTED&&e!==t.Strophe.Status.ATTACHED||(this._c.addHandler(this._onDeviceHandle.bind(this),t.Strophe.NS.ZOOM_IQ_EXT,"iq","result"),this._c.addHandler(this._onZoomTypeHandle.bind(this),t.Strophe.NS.ZOOM_IQ_EXT,"iq","result"))},_onDeviceHandle:function(e,t){const{json:n,isReplay:s}=t;if(s)return!0;const{iq:{zoom:o}}=n;if(!o)return!0;if("getdevices"!==o["@action"])return!0;if(o.item){let e=[];e=Array.isArray(o.item)?o.item:[{name:o.item["@dname"]||"",resource:o.item["@resource"]||"",deviceId:o.item["@deviceid"]||""}];const t=e.map(e=>({name:e["@dname"]||"",resource:e["@resource"]||"",deviceId:e["@deviceid"]||""}));this._deviceCb(t)}return!0},_onZoomTypeHandle:function(e,t){const{json:n,isReplay:s}=t;if(s)return!0;const{iq:{zoom:i}}=n;if(!i)return!0;if(!i["@type"])return!0;switch(i["@type"]){case"presence":const e=(e=>{const{item:t}=e;if(!t)return[];let n=[];if(Array.isArray(t))n=t.map(e=>{const t=o(e.res);return{jid:e["@jid"],mobile:e["@mobile"],res:t}});else if(t["@jid"]){const e=o(t.res);n=[{jid:t["@jid"],mobile:t["@mobile"],res:e}]}return n})(i);this._iqPresecnceCb(e);break;case"offline":this._unreadChatMessageCb&&this._unreadChatMessageCb(i)}return!0},queryPresence(){const e={iq:{"@type":"get","@id":this._c.getUniqueId("iqpresence"),"@from":this._c.jid,"@xmlns":t.Strophe.NS.CLIENT,query:{"@xmlns":t.Strophe.NS.ZOOM_IQ_PRESENCE,"@chunk":"1","@details":"1"}}},n=t.json2xmlDom(e);this._c.sendIQ(n)},queryDevice(){const e={iq:{"@type":"get","@id":this._c.getUniqueId(),"@from":this._c.jid,"@xmlns":t.Strophe.NS.CLIENT,zoom:{"@action":"getdevices","@xmlns":t.Strophe.NS.ZOOM_IQ_EXT}}},n=t.json2xmlDom(e);this._c.sendIQ(n)},addIQPresenceCB:function(e){this._iqPresecnceCb=e},addIQDeviceCB:function(e){this._deviceCb=e},addUnreadChatMessageCountCB:function(e){this._unreadChatMessageCb=e}}),e.WebimPresenceType=void 0,(i=e.WebimPresenceType||(e.WebimPresenceType={})).ooo="ooo",i.dnd="dnd",i.presenting="presenting",i.zoommeeting="zoommeeting",i.pbx="pbx",i.calendar="calendar",i.available="available",i.away="away",i.offline="offline",i.mobile="mobile",i.busy="busy",e.InviteContactResponseType=void 0,(r=e.InviteContactResponseType||(e.InviteContactResponseType={})).INVITE_MESSAGE_SEND_SUCCESS="INVITE_MESSAGE_SEND_SUCCESS",r.INVITE_CONTACT_BE_ACCEPTED="INVITE_CONTACT_BE_ACCEPTED",r.INVITE_CONTACT_BE_DECLINED="INVITE_CONTACT_BE_DECLINED",r.INVITE_CONTACT_OTHERS_INVITE_ME="INVITE_CONTACT_OTHERS_INVITE_ME",r.INVITE_CONTACT_ROSTER_ADD="INVITE_CONTACT_ROSTER_ADD",r.INVITE_CONTACT_ROSTER_REMOVE="INVITE_CONTACT_ROSTER_REMOVE",function(e){e.ADD="add",e.REMOVE="remove"}(c||(c={})),function(e){e.dnd="dnd",e.snooze="snooze",e.busy="busy",e.ooo="ooo"}(a||(a={})),e.XmppResources=void 0,(l=e.XmppResources||(e.XmppResources={})).pwa="ZoomChat_pc_pwa",l.pc="ZoomChat_pc",l.mobile="ZoomChat_mobile",l.pad="ZoomChat_pad",l.pzr="ZoomChat_pzr",e.PresenceShow=void 0,(d=e.PresenceShow||(e.PresenceShow={})).offline="offline",d.away="away",d.dnd="dnd",d.online="available",d.xa="xa",e.PresenceStatus=void 0,(u=e.PresenceStatus||(e.PresenceStatus={})).NA="NA",u.ZoomMeeting="ZM",u.Presenting="ZP",u.Meeting="M",u.Pbx="PBX",u.Busy="BUSY",u.OOO="OOO";const h={jid:"",xmppToken:"",XMPPServer:"",PINGServer:"",enableFetchCoworkerGroup:!1,enableFetchZoomRoomGroup:!0,web:{option:656631},maxReconnectAttempt:10,reconectIntervalMultiplier:1.1,reconnectInterval:4e3,pingInterval:3e4,pingTimeout:1e3,queryVcardInterval:18e6,subscribePresenceInterval:3e5,log:{logLevel:[],logModule:[]},deviceId:"",deviceName:"",PWATokenUrl:"",XMSDomain:"",resouceId:e.XmppResources.pwa};t.Strophe.addConnectionPlugin("Messaging",{_connection:null,_msgcb:null,_recentchatcb:null,init:function(e){this._connection=e},statusChanged:function(e){e!==t.Strophe.Status.CONNECTED&&e!==t.Strophe.Status.ATTACHED||(this._connection.addHandler(this._onReceiveChatMessage.bind(this),null,"message","chat"),this._connection.addHandler(this._onReceiveGroupChatMessage.bind(this),null,"message","groupchat"),this._connection.addHandler(this._onReceiveRecentChat.bind(this),t.Strophe.NS.IQ_PRIVATE,"iq","result"))},addMessageCB:function(e){this._msgcb=e},addRecentChatCB:function(e){this._recentchatcb=e},_onReceiveChatMessage:function(e,n){const{json:s,isReplay:o}=n;if(o)return!0;try{const{message:e}=s,t={};if(e.zmext&&(t.zmext={from:e["@from"],time:e.zmext["@t"]}),e.delay&&(t.delay={stamp:e.delay["@stamp"],time:e.delay["@t"]}),e.zext_call&&(t.zext_call=(e=>{const{zext_call:{action:t,caption:n,raw:s,src_deviceid:o,subtype:i,lcp:r,mid:c},zmext:a,delay:l}=e,d=s.split(";"),u=d[2]||"",h=d[3]||0,m=d[7]||"",p=d[8]||"",f=d[15]||"",y=d[16]||"";return{action:t,meetingNo:u,meetingOption:h,password:p,caption:n,fromJid:e["@from"],fromName:m||a.from["@n"],fromResource:a.from["@res"],fromDeviceId:o,isTimeoutDecline:i,toJid:e["@to"],expireTime:a["@expire_t"]||-1,receiveTime:a["@t"]||-1,delay:l,__raw__:s,iak:f,credential:y,lcp:r,mid:c}})(e)),e.zmsync&&e.zmsync["@type"]&&(t.zmsync={type:e.zmsync["@type"]}),e.zext_subsync&&e.zmtask&&e.zmext){const{zmtask:t,zmext:n}=e;201===n.msg_type&&t[!1]&&(e.inviteContactSyncMessage=(e=>{const{zext_subsync:t}=e;return{action:t["@action"],jid:t["@peerjid"]||"",name:t["@peername"]||"",email:t["@peeremail"],message:e}})(e))}this._msgcb(t)}catch(e){t.Strophe.error(e)}return!0},_onReceiveGroupChatMessage:function(e,t){const{json:n,isReplay:s}=t;if(s)return!0;const{message:o}=n;if(!o.zmext)return!0;const i={zmext:{from:o["@from"],time:o.zmext["@t"]}};return o.delay&&(i.delay={stamp:o.delay["@stamp"],time:o.delay["@t"]}),this._msgcb(i),!0},_onReceiveRecentChat:function(e,t){var n;const{json:s,isReplay:o}=t;if(o)return!0;const{iq:{query:i}}=s;if(!i)return!0;if(null==i||null==(n=i.recentchat)||!n.item)return!0;const{recentchat:{item:r}}=i;let c=[];return Array.isArray(r)?c=r.map(e=>e["@v"]):r["@v"]&&(c=[r["@v"]]),this._recentchatcb(c),!0},sendMessage:function(e){const n="{"+this._connection.getUniqueId()+"}";e.message["@xmlns"]=t.Strophe.NS.CLIENT,e.message["@id"]=n;const s=t.json2xmlDom(e);return this._connection.send(s),n},queryRecentChat:function(){const e="{"+this._connection.getUniqueId("recentchat")+"}",n={iq:{"@id":e,"@type":"get","@from":this._connection.jid,"@xmlns":t.Strophe.NS.CLIENT,query:{"@xmlns":t.Strophe.NS.IQ_PRIVATE,recentchat:{"@xmlns":t.Strophe.NS.ZOOM_IQ_RECENTCHAT}}}},s=t.json2xmlDom(n);return this._connection.send(s),e},requestLcp(e,n,s,o,i){const r=this._connection.getUniqueId(),c=this._connection.deviceId,a=t.Strophe.getBareJidFromJid(this._connection.jid),l={message:{"@from":this._connection.jid,"@id":r,"@type":"chat","@to":a+"/"+i,zext_call:{action:"request_lcp",raw:`;;${e};0;6;${a};${c};${o};;0;0;140;;;;;;${h.resouceId};`,src_deviceid:c,dst_deviceid:n,caption:s,notify_other_devices:0},zmtask:{"@feature":"34"},zmext:{"@t":(new Date).getTime(),msg_type:"57",from:{"@n":o,"@res":h.resouceId},visible:!1}}},d=t.json2xmlDom(l);this._connection.send(d)},sendLcp(e,n,s,o,i,r){const c=this._connection.getUniqueId(),a=this._connection.deviceId,l=t.Strophe.getBareJidFromJid(this._connection.jid),d={message:{"@from":this._connection.jid,"@id":c,"@type":"chat","@to":l+"/"+s,zext_call:{action:"transfer_lcp",raw:`;;${e};0;5;${l};${a};${n};;0;0;139;;;;;;${h.resouceId};`,src_deviceid:a,dst_deviceid:o,caption:i,notify_other_devices:0,lcp:r},zmtask:{"@feature":"34"},zmext:{"@t":(new Date).getTime(),msg_type:"56",from:{"@n":n,"@res":h.resouceId},visible:!1}}},u=t.json2xmlDom(d);this._connection.send(u)},sendInviteContactSyncMessage:function(e){const n="{"+this._connection.getUniqueId()+"}";e.message["@xmlns"]=t.Strophe.NS.CLIENT,e.message["@id"]=n,e.message["@to"]=t.Strophe.getBareJidFromJid(this._connection.jid),e.message["@from"]=this._connection.jid,e.message.zmext.from["@res"]=h.resouceId;const s=t.json2xmlDom(e);this._connection.send(s)}});var m="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:{};function p(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach(function(n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})}),t}function f(e){var t={exports:{}};return e(t,t.exports),t.exports}var y=p(Object.freeze({__proto__:null,default:{}})),v=f(function(e,t){var n;e.exports=n=n||function(e,t){var n;if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(n=globalThis.crypto),!n&&"undefined"!=typeof window&&window.msCrypto&&(n=window.msCrypto),!n&&void 0!==m&&m.crypto&&(n=m.crypto),!n)try{n=y}catch(e){}var s=function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),i={},r=i.lib={},c=r.Base={extend:function(e){var t=o(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=r.WordArray=c.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||d).stringify(this)},concat:function(e){var t=this.words,n=e.words,s=this.sigBytes,o=e.sigBytes;if(this.clamp(),s%4)for(var i=0;i<o;i++){var r=n[i>>>2]>>>24-i%4*8&255;t[s+i>>>2]|=r<<24-(s+i)%4*8}else for(var c=0;c<o;c+=4)t[s+c>>>2]=n[c>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=c.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(s());return new a.init(t,e)}}),l=i.enc={},d=l.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,s=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;s.push((i>>>4).toString(16)),s.push((15&i).toString(16))}return s.join("")},parse:function(e){for(var t=e.length,n=[],s=0;s<t;s+=2)n[s>>>3]|=parseInt(e.substr(s,2),16)<<24-s%8*4;return new a.init(n,t/2)}},u=l.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,s=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;s.push(String.fromCharCode(i))}return s.join("")},parse:function(e){for(var t=e.length,n=[],s=0;s<t;s++)n[s>>>2]|=(255&e.charCodeAt(s))<<24-s%4*8;return new a.init(n,t)}},h=l.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},p=r.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,s=this._data,o=s.words,i=s.sigBytes,r=this.blockSize,c=i/(4*r),l=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*r,d=e.min(4*l,i);if(l){for(var u=0;u<l;u+=r)this._doProcessBlock(o,u);n=o.splice(0,l),s.sigBytes-=d}return new a.init(n,d)},clone:function(){var e=c.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=p.extend({cfg:c.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}});var f=i.algo={};return i}(Math)}),g=f(function(e,t){e.exports=v.enc.Utf8}),C=f(function(e,t){var n;e.exports=(n=v,function(){var e=n,t=e.lib.WordArray;function s(e,n,s){for(var o=[],i=0,r=0;r<n;r++)if(r%4){var c=s[e.charCodeAt(r-1)]<<r%4*2|s[e.charCodeAt(r)]>>>6-r%4*2;o[i>>>2]|=c<<24-i%4*8,i++}return t.create(o,i)}e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,s=this._map;e.clamp();for(var o=[],i=0;i<n;i+=3)for(var r=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,c=0;c<4&&i+.75*c<n;c++)o.push(s.charAt(r>>>6*(3-c)&63));var a=s.charAt(64);if(a)for(;o.length%4;)o.push(a);return o.join("")},parse:function(e){var t=e.length,n=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<n.length;i++)o[n.charCodeAt(i)]=i}var r=n.charAt(64);if(r){var c=e.indexOf(r);-1!==c&&(t=c)}return s(e,t,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),n.enc.Base64)});t.Strophe.addConnectionPlugin("presence",{_c:null,_presencecb:null,init:function(e){this._c=e},statusChanged:function(e){e!==t.Strophe.Status.CONNECTED&&e!==t.Strophe.Status.ATTACHED||(this._c.addHandler(this._onInviteContactOperationIQ.bind(this),t.Strophe.NS.CLIENT,"iq","set"),this._c.addHandler(this._onReceivePresence2.bind(this),t.Strophe.NS.CLIENT,"presence",null))},online:function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n={presence:{"@from":this._c.jid,"@xmlns":t.Strophe.NS.CLIENT,status:{"#text":"NA"},priority:{"#text":"15"}}};e&&(n.presence.manual={"#text":"1"});const s=t.json2xmlDom(n);this._c.send(s)},offline:function(){const e={presence:{"@from":this._c.jid,"@to":this._c.jid,"@type":"unavailable","@xmlns":t.Strophe.NS.CLIENT}},n=t.json2xmlDom(e);this._c.send(n)},busy:function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n={presence:{"@from":this._c.jid,"@xmlns":t.Strophe.NS.CLIENT,show:{"#text":"away"},status:{"#text":"BUSY"},priority:{"#text":"15"},zcap:{"#text":"e2e:none"}}};e&&(n.presence.manual={"#text":"1"});const s=t.json2xmlDom(n);this._c.send(s)},dnd:function(){const e={presence:{"@from":this._c.jid,"@xmlns":t.Strophe.NS.CLIENT,show:{"#text":"xa"},status:{"#text":"NA"},priority:{"#text":"15"},zcap:{"#text":"e2e:none"}}},n=t.json2xmlDom(e);this._c.send(n)},outofoffice:function(e){const n={presence:{"@from":this._c.jid,"@xmlns":t.Strophe.NS.CLIENT,show:{"#text":"away"},status:{"#text":"OOO"},priority:{"#text":"15"},zcap:{"#text":"e2e:none"}}};e&&(n.presence.manual={"#text":"1"});const s=t.json2xmlDom(n);this._c.send(s)},inMeeting:function(e){const n={presence:{"@from":this._c.jid,"@xmlns":t.Strophe.NS.CLIENT,show:{"#text":"dnd"},status:{"#text":"ZM"},priority:{"#text":"15"}}};if(e){const t=C.stringify(g.parse(JSON.stringify({info:[e]})));n.presence.zcap={"#text":"e2e:none"},n.presence.mcap={"#text":t}}const s=t.json2xmlDom(n);this._c.send(s)},inPresenting:function(e){const n={presence:{"@from":this._c.jid,"@xmlns":t.Strophe.NS.CLIENT,show:{"#text":"dnd"},status:{"#text":"ZP"},priority:{"#text":"15"}}};if(e){const t=C.stringify(g.parse(JSON.stringify({info:[e]})));n.presence.zcap={"#text":"e2e:none"},n.presence.mcap={"#text":t}}const s=t.json2xmlDom(n);this._c.send(s)},inPhoneCall:function(){const e={presence:{"@from":this._c.jid,"@xmlns":t.Strophe.NS.CLIENT,show:{"#text":"dnd"},status:{"#text":"PBX"},priority:{"#text":"15"}}},n=t.json2xmlDom(e);this._c.send(n)},away:function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n={presence:{"@from":this._c.jid,"@xmlns":t.Strophe.NS.CLIENT,show:{"#text":"away"},status:{"#text":"NA"},priority:{"#text":"15"}}};e&&(n.presence.manual={"#text":"1"});const s=t.json2xmlDom(n);this._c.send(s)},_onReceivePresence2:function(e,t){const{json:n,isReplay:s}=t;if(s)return!0;const{presence:o}=n,{show:i,status:r,mcap:c,manual:a,zoom:l}=o,d=o["@from"]||"",u=o["@to"]||"",h=o["@type"]||"";if("sub-ack"===h||"subscribe"===h||"subscribed"===h||"unsubscribed"===h){const e={inviteContactResponse:{type:{"sub-ack":"INVITE_MESSAGE_SEND_SUCCESS",subscribe:"INVITE_CONTACT_OTHERS_INVITE_ME",subscribed:"INVITE_CONTACT_BE_ACCEPTED",unsubscribed:"INVITE_CONTACT_BE_DECLINED"}[h],email:o["@email"]||"",from:d,to:u,sameorg:o["@sameorg"]||"",status:r?JSON.parse(r):{}}};return this._presencecb(e),!0}const m={from:d,to:u};if(h&&"available"!==h?"unavailable"===h&&(m.show="offline"):m.show="available",i&&(m.show=i),r&&(m.status=r),c){const e=g.stringify(C.parse(c));m.meetingInfo=JSON.parse(e).info}return m.isManual=!(1!==a),l&&"1"===l["@mobile"]&&(m.from=d.includes("/")?d:`${d}/ZoomChat_mobile_fake_resource`,m.show="available",m.status="NA"),this._presencecb(m),!0},_onInviteContactOperationIQ:function(e,n){const{json:s,isReplay:o}=n;if(o)return!0;const{iq:{query:i,zoom:r}}=s;if(!i&&!r)return!0;if(i){if(i["@xmlns"]===t.Strophe.NS.ROSTER&&i.item){const{item:e}=i;let t=[];Array.isArray(e)?t=e.map(e=>({jid:e["@jid"]||"",subscription:e["@subscription"]||"",group:e["@group"]||""})).filter(e=>!!e.jid):e["@jid"]&&(t=[{jid:e["@jid"],subscription:e["@subscription"]||"",group:e["@group"]||""}]),t.length>0&&this._rostercb({type:"add",data:t})}return!0}if(r){const e=r["@xmlns"],n=r["@type"],s=r.rosteritem;if("r_remove"===n&&s&&e===t.Strophe.NS.ZOOM_IQ_EXT){let e=[];Array.isArray(s)?e=s.map(e=>({jid:e["@jid"]||"",type:n})).filter(e=>!!e.jid):s["@jid"]&&(e=[{jid:s["@jid"],type:n}]),e.length>0&&this._rostercb({type:"remove",data:e})}}return!0},addPresenceHandle(e){this._presencecb=e},addIQHandle(e){this._iqcb=e},addRosterHandle(e){this._rostercb=e},inviteContactByEmail(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{inviterName:n="",inviterEmail:s="",inviteeEmail:o=""}=e;if(!s||!o)return;const i=this._c.getUniqueId("presence"),r={presence:{"@id":i,"@email":o,"@from":this._c.jid,"@type":"subscribe","@xmlns":t.Strophe.NS.CLIENT,status:{"#text":JSON.stringify({e:s,screenname:n,t:Date.now()})}}},c=t.json2xmlDom(r);return this._c.send(c),i},deleteContactByJid(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!e||this._c.jid===e)return;const n=this._c.getUniqueId("presence"),s={presence:{"@id":n,"@from":this._c.jid,"@to":e,"@type":"unsubscribe","@xmlns":t.Strophe.NS.CLIENT}},o=t.json2xmlDom(s);return this._c.send(o),n}});const S=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e=>"number"==typeof e)(e)?e:t};var _,T;let I,E;var b;let N,P,R,O,w;var x;t.Strophe.addConnectionPlugin("presencePolicy",{_c:null,_presencePolicyCb:null,init:function(e){this._c=e},statusChanged:function(e){e!==t.Strophe.Status.CONNECTED&&e!==t.Strophe.Status.ATTACHED||this._c.addHandler(this._onPresencePolicyHandle.bind(this),t.Strophe.NS.CLIENT,"iq","result")},_onPresencePolicyHandle(e,t){const{json:n,isReplay:s}=t;if(s)return!0;const{iq:{query:o}}=n;if(!o)return!0;if("zoom:iq:notify"!==o["@xmlns"])return!0;let i=null;return o.recess&&(i={name:"ooo",value:{duration:S(o.recess["@duration"])}}),o.snooze&&(i={name:"snooze",value:{duration:S(o.snooze["@duration"]),from:S(o.snooze["@snooze_from"]),to:S(o.snooze["@snooze_to"])}}),o.busy&&(i={name:"busy",value:{duration:S(o.busy["@duration"])}}),o.dnd&&(i={name:"dnd",value:{from:o.dnd["@from"]||"",to:o.dnd["@to"]||""}}),"function"==typeof this._presencePolicyCb&&this._presencePolicyCb(i),!0},_composeAndSendGetPolicy(e,n){const s=this._c.getUniqueId("presence-policy-get"),o={iq:{"@id":s,"@from":this._c.jid,"@xmlns":t.Strophe.NS.CLIENT,"@type":"get",query:{"@xmlns":"zoom:iq:notify",[e]:n}}},i=t.json2xmlDom(o);return this._c.send(i),s},_composeAndSendSetPolicy(e,n){const s=this._c.getUniqueId("presence-policy-set"),o={iq:{"@id":s,"@from":this._c.jid,"@xmlns":t.Strophe.NS.CLIENT,"@type":"set",query:{"@xmlns":t.Strophe.NS.notify,"@sync":"true",[e]:n}}},i=t.json2xmlDom(o,{suppressBooleanAttributes:!1});return this._c.send(i),s},getDndPolicy(){return this._composeAndSendGetPolicy("dnd",{"@xmlns":"zoom:notify:dnd"})},setDndPolicy(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n={"@xmlns":"zoom:notify:dnd"};return e&&t&&Object.assign(n,{"@from":e,"@to":t}),this._composeAndSendSetPolicy("dnd",n)},getSnoozePolicy(){return this._composeAndSendGetPolicy("snooze",{"@xmlns":"zoom:notify:snooze"})},setSnoozePolicy(e,n){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const o={"@xmlns":t.Strophe.NS.snooze,"@duration":s,"@snooze_from":e,"@snooze_to":n};return this._composeAndSendSetPolicy("snooze",o)},getOOOPolicy(){return this._composeAndSendGetPolicy("recess",{"@xmlns":"zoom:notify:recess"})},setOOOPolicy(){const e={"@xmlns":"zoom:notify:recess","@duration":arguments.length>0&&void 0!==arguments[0]?arguments[0]:0};return this._composeAndSendSetPolicy("recess",e)},getBusyPolicy(){return this._composeAndSendGetPolicy("busy",{"@xmlns":"zoom:notify:busy"})},setBusyPolicy(){const e={"@xmlns":"zoom:notify:busy","@duration":arguments.length>0&&void 0!==arguments[0]?arguments[0]:0};return this._composeAndSendSetPolicy("busy",e)},addPresencePolicyCB:function(e){this._presencePolicyCb=e}}),t.Strophe.addConnectionPlugin("room",{_c:null,roomcb:null,init:function(e){this._c=e},statusChanged:function(e){e!==t.Strophe.Status.CONNECTED&&e!==t.Strophe.Status.ATTACHED||this._c.addHandler(this._onIQRoomHandle.bind(this),t.Strophe.NS.ZOOM_IQ_ROOM,"iq","result")},_onIQRoomHandle:function(e,t){const{json:n,isReplay:s}=t;if(s)return!0;const{iq:{room:o}}=n;return!o||!o["@action"]||(this.roomcb({type:"result",id:n.iq["@id"],data:{action:o["@action"]}}),!0)},changeRoomOption(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=this._c.getUniqueId("room"),o={iq:{"@id":s,"@type":"set","@from":t.Strophe.getBareJidFromJid(this._c.jid),"@to":e,"@xmlns":t.Strophe.NS.CLIENT,zoom:{"@action":"edit","@xmlns":t.Strophe.NS.ZOOM_IQ_ROOM}}};Object.entries(n).forEach(e=>{let[t,n]=e;o.iq.zoom[t]=n});const i=t.json2xmlDom(o);return this._c.sendIQ(i,null,()=>{this.roomcb({type:"error",id:s,data:null})},3e3),s},addRoomHandler:function(e){this.roomcb=e}}),e.WebimStatus=void 0,(_=e.WebimStatus||(e.WebimStatus={})).INIT="INIT",_.ERROR="ERROR",_.CONNECTING="CONNECTING",_.RECONNECTING="RECONNECTING",_.CONNFAIL="CONNFAIL",_.AUTHENTICATING="AUTHENTICATING",_.AUTHFAIL="AUTHFAIL",_.CONNECTED="CONNECTED",_.DISCONNECTED="DISCONNECTED",_.DISCONNECTING="DISCONNECTING",_.CONNTIMEOUT="CONNTIMEOUT",e.WebimStatusErrorType=void 0,(T=e.WebimStatusErrorType||(e.WebimStatusErrorType={})).CONFLICT="conflict",T.UNKNOWN="unknown",T.REVOKE_TOKEN="revoke-token",function(e){e.Invite="invite",e.OldDecline="old_decline",e.Accept="accept",e.Decline="decline",e.Cancel="cancel"}(I||(I={})),function(e){e.SyncLoginInfo="1"}(E||(E={})),e.InviteContactSyncMessageType=void 0,(b=e.InviteContactSyncMessageType||(e.InviteContactSyncMessageType={})).SUBSENT="subsent",b.DOACCEPT="doaccept",b.SUBSCRIBED="subscribed",b.SUBREJECT="subreject",b.UNSUBSCRIBED="unsubscribed",function(e){e[e.Normal=0]="Normal",e[e.Addon=1]="Addon",e[e.ZoomRoom=2]="ZoomRoom"}(N||(N={})),function(e){e[e.Default=0]="Default",e[e.Coworker=1]="Coworker",e[e.ZoomRoom=60]="ZoomRoom",e[e.PersonGroup=500]="PersonGroup"}(P||(P={})),function(e){e[e.ROSTER_VERSION_CB=4]="ROSTER_VERSION_CB",e[e.ROSTER_ITEMS_CB=5]="ROSTER_ITEMS_CB",e[e.ROSTER_ITEM_DEL_CB=6]="ROSTER_ITEM_DEL_CB",e[e.ROSTER_ITEM_ADD_CB=7]="ROSTER_ITEM_ADD_CB",e[e.ROSTER_BLOCKED_LIST=100]="ROSTER_BLOCKED_LIST"}(R||(R={})),function(e){e.GET="GET",e.ADD="ADD",e.REMOVE="REMOVE"}(O||(O={})),function(e){e.QUERY="QUERY",e.UPDATE="UPDATE"}(w||(w={})),e.WebimLogLevel=void 0,(x=e.WebimLogLevel||(e.WebimLogLevel={}))[x.DEBUG=0]="DEBUG",x[x.INFO=1]="INFO",x[x.WARN=2]="WARN",x[x.ERROR=3]="ERROR",x[x.NONE=4]="NONE";const M="WEB_SESSION_EXPIRED_ERROR";var D,z;e.WebimEventType=void 0,(D=e.WebimEventType||(e.WebimEventType={})).OnlineMembers="OnlineMembers",D.PresenceChange="PresenceChange",D.ServerGroups="ServerGroups",D.GroupChange="GroupChange",D.RosterChange="RosterChange",D.RosterBlocklist="RosterBlocklist",D.MessageChange="Message",D.RecentChat="RecentChat",D.IqResultChange="Response",D.VcardChange="VcardChange",D.RoomChange="RoomChange",D.ConnectionStatusChange="ConnectionStatusChange",D.DurationChange="DurationChange",D.DeviceListChange="DeviceListChange",D.InviteContactChange="InviteContactChange",D.InviteContactSyncMessage="InviteContactSyncMessage",D.LoginOtherDevice="LoginOtherDevice",D.UnreadChatMessageCount="UnreadChatMessageCount",D.PresencePolicy="PresencePolicy",D.staredContacts="staredContact",e.WebimModuleName=void 0,(z=e.WebimModuleName||(e.WebimModuleName={})).vcard="vcard",z.presence="presence",z.roster="roster",z.connection="connection",z.message="message",z.xms="xms",z.room="room",z.contact="contact",t.Strophe.addConnectionPlugin("roster",{_c:null,rostercb:null,init:function(e){this._c=e},statusChanged:function(e){e!==t.Strophe.Status.CONNECTED&&e!==t.Strophe.Status.ATTACHED||(this._c.addHandler(this._onBlockListHandle.bind(this),t.Strophe.NS.URN_XMPP_BLOCKING,"iq"),this._c.addHandler(this._onIqZoomHandle.bind(this),t.Strophe.NS.ZOOM_IQ_EXT,"iq","result"))},_onBlockListHandle:function(e,t){const{json:n,isReplay:s}=t;if(s)return!0;try{var o,i;const e=e=>{if(!e)return[];let t=[];return Array.isArray(e)?t=e.map(e=>e["@jid"]):e["@jid"]&&(t=[e["@jid"]]),t},{iq:t}=n,s=t["@type"];let r={};if(t.blocklist&&"result"===s){const{item:n}=t.blocklist;r={data:e(n),type:O.GET}}else if(t.block&&"set"===s){const{item:n}=t.block;r={data:e(n),type:O.ADD}}else if(t.unblock&&"set"===s){const{item:n}=t.unblock;r={data:e(n),type:O.REMOVE}}return(null==(o=r)||null==(i=o.data)?void 0:i.length)>0&&this.rostercb(R.ROSTER_BLOCKED_LIST,r),!0}catch(t){return console.error("roster plugin _onBlockListHandle error",t),!0}},_onIqZoomHandle:function(e,t){const{json:n,isReplay:s}=t;if(s)return!0;try{const{iq:{zoom:e}}=n;if(!e)return!0;if(!e["@type"])return!0;let t;switch(e["@type"]){case"version":t=(e=>{const{group:t,default:n}=e,s=[];return n&&`${n["@version"]}`&&s.push({id:"default",version:n["@version"],type:"default"}),t&&(Array.isArray(t)?t.forEach(e=>{s.push({id:e["@id"]||"0",version:e["@version"]||"0",type:e["@type"]||"0"})}):t["@id"]&&s.push({id:t["@id"]||"0",version:t["@version"]||"0",type:t["@type"]||"0"})),s})(e),this.rostercb(R.ROSTER_VERSION_CB,t);break;case"roster":t=(e=>{const{group:t,default:n}=e,s={chunk:e["@chunk"]};if(null!=n&&n.item){let e=[];if(Array.isArray(n.item))e=n.item.map(e=>({jid:e["@jid"]||"",fname:e["@fname"]||"",lname:e["@lname"]||"",type:e["@type"]||0,cmd:e["@cmd"]||"",gname:e.group||"default"}));else if(n.item["@jid"]){const{item:t}=n;e=[{jid:t["@jid"]||"",fname:t["@fname"]||"",lname:t["@lname"]||"",type:t["@type"]||0,cmd:t["@cmd"]||"",gname:t.group||"default"}]}s.group={total:n["@total"],first:n["@first"],version:n["@version"],items:e}}if(t){if(s.groups=[],Array.isArray(t))t.forEach(e=>{const{item:t}=e;let n=t;Array.isArray(t)||(n=[t]);const o=n.filter(Boolean).map(t=>({jid:t["@jid"]||"",fname:t["@fname"]||"",lname:t["@lname"]||"",type:t["@type"]||"0",cmd:t["@cmd"]||"",gname:e["@name"]||""}));s.groups.push({total:e["@total"]||0,first:e["@first"]||0,id:e["@id"]||0,version:e["@version"]||0,name:e["@name"]||"",option:e["@option"]||0,items:o})});else if(Array.isArray(null==t?void 0:t.item)){const e=t.item.map(e=>({jid:e["@jid"]||"",fname:e["@fname"]||"",lname:e["@lname"]||"",type:e["@type"]||0,cmd:e["@cmd"]||"",gname:t["@name"]||""}));s.groups=[{total:t["@total"]||0,first:t["@first"]||0,id:t["@id"]||0,version:t["@version"]||0,name:t["@name"]||"",option:t["@option"]||0,items:e}]}}else s.groups=[];return s})(e),this.rostercb(R.ROSTER_ITEMS_CB,t)}return!0}catch(t){return console.error("roster plugin _onIqZoomHandle error",t),!0}},queryChunk:function(e){const n=this._c.getUniqueId("group"),s={iq:{"@from":t.Strophe.getBareJidFromJid(this._c.jid),"@id":n,"@type":"get","@xmlns":t.Strophe.NS.CLIENT,query:{"@xmlns":t.Strophe.NS.ZOOM_IQ_GROUP,"@chunk":e}}},o=t.json2xmlDom(s);return this._c.sendIQ(o),n},queryGroups:function(e,n,s,o){const i=this._c.getUniqueId("group"),{groups:r,chunk:c,directory:a}=e,l={iq:{"@id":i,"@type":"get","@from":t.Strophe.getBareJidFromJid(this._c.jid),"@xmlns":t.Strophe.NS.CLIENT,query:{"@xmlns":t.Strophe.NS.ZOOM_IQ_GROUP,"@chunk":c,"@directory":a}}},d=r.filter(e=>"default"!==e.id).map(e=>({"@id":e.id,"@version":e.version})),u=r.filter(e=>"default"===e.id).map(e=>({"@version":e.version}));d&&(l.iq.query.group=d),u&&(l.iq.query.default=u);const h=t.json2xmlDom(l);return this._c.sendIQ(h,n,s,o),i},queryGroupInfos:function(e,n,s){const o=this._c.getUniqueId("group"),i={iq:{"@from":t.Strophe.getBareJidFromJid(this._c.jid),"@id":o,"@type":"get","@xmlns":t.Strophe.NS.CLIENT,query:{"@xmlns":t.Strophe.NS.ZOOM_IQ_VERSION}}},r=t.json2xmlDom(i);return this._c.sendIQ(r,e,n,s),o},fetchBlockList:function(e,n,s){const o=this._c.getUniqueId("roster"),i={iq:{"@from":t.Strophe.getBareJidFromJid(this._c.jid),"@id":o,"@type":"get","@xmlns":t.Strophe.NS.CLIENT,blocklist:{"@xmlns":t.Strophe.NS.URN_XMPP_BLOCKING}}},r=t.json2xmlDom(i);return this._c.sendIQ(r,e,n,s),o},addRosterHandler:function(e){this.rostercb=e}}),t.Strophe.addConnectionPlugin("contact",{_c:null,_presencecb:null,_asyncQueue:{},init:function(e){this._c=e},statusChanged:function(e){e!==t.Strophe.Status.CONNECTED&&e!==t.Strophe.Status.ATTACHED||(this._c.addHandler(this._onReceiveStarredContacts.bind(this),t.Strophe.NS.IQ_PRIVATE,"iq","result"),this._c.addHandler(this._onReceiveStarredContactResponse.bind(this),t.Strophe.NS.JABBER_CLIENT,"iq"))},fetchStarredContacts(){const e=this._c.getUniqueId(),n={iq:{"@id":e,"@from":this._c.jid,"@xmlns":t.Strophe.NS.CLIENT,"@type":"get",query:{"@xmlns":t.Strophe.NS.IQ_PRIVATE,starsession:{"@xmlns":t.Strophe.NS.STARSESSION}}}},s=t.json2xmlDom(n);return this._c.send(s),e},async starOrUnStarContact(e){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const s=this._c.getUniqueId(),o={iq:{"@id":s,"@from":this._c.jid,"@xmlns":t.Strophe.NS.CLIENT,"@type":"set",query:{"@xmlns":t.Strophe.NS.IQ_PRIVATE,"@sync":!0,starsession:{"@xmlns":t.Strophe.NS.STARSESSION,"@storage":n?"add":"remove",item:{"@v":e}}}}},i=t.json2xmlDom(o,{suppressBooleanAttributes:!1});return this._c.send(i),new Promise((e,t)=>{setTimeout(()=>{delete this._asyncQueue[s]},5e3),this._asyncQueue[s]={resolve:e,reject:t}})},_onReceiveStarredContactResponse(e,t){const{json:n,isReplay:s}=t;if(s)return!0;const{iq:o}=n,i=o["@id"],r=o["@type"];return!this._asyncQueue[i]||("result"===r?this._asyncQueue[i].resolve(i):this._asyncQueue[i].reject(),!0)},_onReceiveStarredContacts(e,t){var n;const{json:s,isReplay:o}=t;if(o)return!0;const{iq:{query:i}}=s;if(!i)return!0;if(null==i||null==(n=i.starsession)||!n.item)return!0;const{starsession:{item:r}}=i;let c=[];return Array.isArray(r)?c=r.map(e=>e["@v"]):r["@v"]&&(c=[r["@v"]]),this._starContactHandle&&this._starContactHandle(c,null==i?void 0:i.starsession["@storage"]),!0},addStarOrUnStarContactHandle(e){this._starContactHandle=e}});const A=e=>{if(!e.vCard)return{};const{JABBERID:t,N:n,SIG:s,DESC:o,TEL:i,INTRO:r,EXT:c,ORG:a,USER_TYPE:l,EMAIL:d,WKLOC:u}=e.vCard,h={};if(h.jid=t,n&&(h.firstName=n.GIVEN||"",h.lastName=n.FAMILY+""||"",h.nickName=n.NICK||""),o&&(h.picUrl=o||""),d&&(d.WORK||d.USERID)&&(h.email=d.WORK||d.USERID),a&&a.ORGUNIT&&(h.orgUnit=a.ORGUNIT.split(";").filter(Boolean)),s&&(h.signature={begin:s["@begin"],end:s["@end"],option:s["@option"],text:s["#text"]}),i&&(Array.isArray(i)?i.forEach(e=>{if("SIP"in e||"PBX"in e||(h.phone={sip:"",normal:e.NUMBER||"",work:e.WORK&&e.WORK.NUMBER||"",home:e.HOME&&e.HOME.NUMBER||""}),"SIP"in e&&(h.sip={normal:e.NUMBER||""}),"PBX"in e){const t=e.NUMBER||"{}",{ext:n,dn:s,cn:o}=JSON.parse(t)||{};h.pbx={ext:n&&n.toString()||"",dn:s||[],cn:o||""}}}):h.phone={sip:i.SIP||"",normal:i.NUMBER||"",work:i.WORK&&i.WORK.NUMBER||"",home:i.HOME&&i.HOME.NUMBER||""}),r&&(h.intro=r),c&&(h.ext={cmpy:c.CMPY||"",job:c.JOB||"",manager:c.MANAGER+"",adr:c.ADR||"",dept:c.DEPT||"",wkcode:c.WKCODE+""||"",wkphone:c.WKPHONE+""||"",pronoun:c.PRONOUN||"",audit:c.AUDIT,audit_t:c.AUDIT_T+""||"",platform:c.PLATFORM||"",info:c.INFO&&JSON.parse(c.INFO)||""},c.WKPHONES&&c.WKPHONES.ITEM)){let e=c.WKPHONES.ITEM;Array.isArray(e)||(e=[e]);const t=e.map(e=>({label:e["@label"]||"",text:e["#text"]+""||"",code:"+"+e["@code"]||0,country:e["@country"]||"",type:e["@type"]||"",verified:e["@verified"]||""}));h.wkphones=t}return h.userType=l+""||"0",h.wkloc=u+""||"0",h};t.Strophe.addConnectionPlugin("vcard",{_c:null,_vardcb:null,init:function(e){this._c=e},statusChanged:function(e){e!==t.Strophe.Status.CONNECTED&&e!==t.Strophe.Status.ATTACHED||(this._c.addHandler(this._onReceivIQ.bind(this),t.Strophe.NS.VCARD_TEMP,"iq","result"),this._c.addHandler(this._onReceivIQ2.bind(this),t.Strophe.NS.ZOOM_IQ_EXT,"iq","result"))},_onReceivIQ:function(e,t){const{json:n,isReplay:s}=t;if(s)return!0;try{const{iq:{vCard:e}}=n,t=A(e);return!t.jid||(this._vardcb({action:w.QUERY,data:t}),!0)}catch(t){return console.error("vcard plugin _onReceivIQ error",t),!0}},_onReceivIQ2:function(e,t){const{json:n,isReplay:s}=t;if(s)return!0;try{const{iq:{zoom:e}}=n;if(!e||"vcard_update"!==e["@type"])return!0;const t=e["@jid"];return this._vardcb({action:w.UPDATE,data:t}),!0}catch(t){return console.error("vcard plugin _onReceivIQ2 error",t),!0}},query:function(e,n,s,o){const i={iq:{"@id":this._c.getUniqueId("vcard"),"@to":e,"@type":"get","@xmlns":t.Strophe.NS.CLIENT,vCard:{"@xmlns":t.Strophe.NS.VCARD_TEMP}}},r=t.json2xmlDom(i);this._c.sendIQ(r,n,s,o)},addVCardHandler:function(e){return this._vardcb=e}}),t.Strophe.addConnectionPlugin("ackmessage",{_c:null,init:function(e){this._c=e},ack:function(e,n,s,o,i){const r=this._c.getUniqueId("ack");try{const c={iq:{"@id":r,"@type":"get","@xmlns":t.Strophe.NS.CLIENT,zoom:{"@action":"ack_msg","@from":t.Strophe.getNodeFromJid(n),"@sender":n,"@time":e,"@xmlns":t.Strophe.NS.ZOOM_IQ_EXT}}},a=t.json2xmlDom(c);this._c.sendIQ(a,s,o,i)}catch(e){t.Strophe.error(e)}return r}}),Object.entries(s).forEach(e=>{let[n,s]=e;t.Strophe.addNamespace(n,s)});class j{constructor(t){var n=this;this.module=void 0,this.validate=e=>j.logLevels.includes(e)&&j.logModules.includes(this.module),this.debug=function(){for(var t=arguments.length,s=new Array(t),o=0;o<t;o++)s[o]=arguments[o];n.validate(e.WebimLogLevel.DEBUG)&&console.debug(`[${n.module}]`,...s)},this.info=function(){for(var t=arguments.length,s=new Array(t),o=0;o<t;o++)s[o]=arguments[o];n.validate(e.WebimLogLevel.INFO)},this.warn=function(){for(var t=arguments.length,s=new Array(t),o=0;o<t;o++)s[o]=arguments[o];n.validate(e.WebimLogLevel.WARN)},this.error=function(){for(var t=arguments.length,s=new Array(t),o=0;o<t;o++)s[o]=arguments[o];n.validate(e.WebimLogLevel.ERROR)&&console.error(`[${n.module}]`,...s)},this.module=t}}j.logLevels=[],j.logModules=[],j.setLogLevels=e=>{j.logLevels=e},j.setLogModules=e=>{j.logModules=e};const q=()=>{},B=new j(e.WebimModuleName.presence);class k{constructor(n){var s=this;this.connection=void 0,this.dispatch=void 0,this.presencesMap=void 0,this.deviceList=void 0,this.inviteContactResolve=void 0,this.deleteContactResolve=void 0,this.onPresencePolicyChange=t=>{this.dispatch({type:e.WebimEventType.PresencePolicy,data:t})},this.onReciveDeviceList=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const{jid:n}=h,o=t.map(e=>{const{resource:t}=e,o=s.presencesMap.get(n),i={...e};if(null!=o&&o.resources[t]){const e=null==o?void 0:o.resources[t],n=e.meetingInfo;n&&(i.meetingInfo=n);const r=s.getPresenceType({[t]:e});r&&(i.presenceType=r)}return i});s.deviceList=o,s.dispatch({type:e.WebimEventType.DeviceListChange,data:o})},this.onIqPresenceChange=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];B.debug("receive iq presences",t);const{jid:n}=h;t.filter(e=>e.jid===n).forEach(t=>{const{jid:n,mobile:o,res:i=[]}=t,r=s.presencesMap.get(n)||{presenceType:e.WebimPresenceType.offline,lastSubscribeTime:Date.now(),resources:{},latestPresence:null};if(i.forEach(t=>{r.resources[t.resource]||(r.resources[t.resource]={show:e.PresenceShow.offline,status:e.PresenceStatus.NA,resource:t.resource});const n={...r.resources[t.resource],...t};r.resources[t.resource]=n,r.latestPresence=n}),String(o)===String(1)){const t={resource:e.XmppResources.mobile,show:e.PresenceShow.online,status:e.PresenceStatus.NA};r.resources[e.XmppResources.mobile]=t,r.latestPresence=t}const c=s.getPresenceType(r.resources);c&&(r.presenceType=c),s.presencesMap.set(n,r)})},this.onPresenceChange=n=>{B.debug("receive presence change",n);const{from:s,show:o,status:i,isManual:r,meetingInfo:c,inviteContactResponse:a}=n,{jid:l}=h;if(a)return void(a.type===e.InviteContactResponseType.INVITE_MESSAGE_SEND_SUCCESS?this.inviteContactResolve&&this.inviteContactResolve(a):a.type!==e.InviteContactResponseType.INVITE_CONTACT_BE_ACCEPTED&&a.type!==e.InviteContactResponseType.INVITE_CONTACT_BE_DECLINED&&a.type!==e.InviteContactResponseType.INVITE_CONTACT_OTHERS_INVITE_ME||this.dispatch({type:e.WebimEventType.InviteContactChange,data:a}));const d=t.Strophe.getResourceFromJid(s),u=t.Strophe.getBareJidFromJid(s);if(!d)return;if(u!==l)return;const m={resource:d,show:o,status:i,isManual:r};c&&(m.meetingInfo=c);const p=this.presencesMap.get(u)||{presenceType:e.WebimPresenceType.offline,lastSubscribeTime:Date.now(),resources:{},latestPresence:null};p.resources[d]=m,p.latestPresence=m;const f=this.getPresenceType(p.resources);if(f&&(p.presenceType=f),this.presencesMap.set(u,p),u===h.jid&&this.deviceList.length>0){const t=this.getPresenceType({[d]:m});let n=!1;const s=this.deviceList.map(e=>{if(e.resource===d){n=!0;const s={...e};return t&&(s.presenceType=t),c?s.meetingInfo=c:delete s.meetingInfo,s}return e});n?(this.deviceList=s,this.dispatch({type:e.WebimEventType.DeviceListChange,data:s})):this.queryDevice()}},this.onRosterListChange=t=>{B.debug("on RosterList Change",t);const n={add:e.InviteContactResponseType.INVITE_CONTACT_ROSTER_ADD,remove:e.InviteContactResponseType.INVITE_CONTACT_ROSTER_REMOVE};Object.keys(n).includes(t.type)&&("remove"===t.type&&this.deleteContactResolve&&this.deleteContactResolve(t),this.dispatch({type:e.WebimEventType.InviteContactChange,data:{type:n[t.type],roster:t}}))},this.onConnectionChange=t=>{e.WebimStatus.CONNECTED===t.status&&this.queryIqPresence()},this.queryIqPresence=()=>{var e,t;null==(e=this.connection)||null==(t=e.zConnection)||t.iqpresence.queryPresence()},this.determinePresenceType=t=>{const[n,s,o,i]=t;return n.some(t=>t.show===e.PresenceShow.away&&t.status===e.PresenceStatus.OOO)||s.some(t=>t.show===e.PresenceShow.away&&t.status===e.PresenceStatus.OOO)||o.some(t=>t.show===e.PresenceShow.away&&t.status===e.PresenceStatus.OOO)||i.some(t=>t.show===e.PresenceShow.away&&t.status===e.PresenceStatus.OOO)?e.WebimPresenceType.ooo:n.some(t=>t.show===e.PresenceShow.xa)||s.some(t=>t.show===e.PresenceShow.xa)||o.some(t=>t.show===e.PresenceShow.xa)||i.some(t=>t.show===e.PresenceShow.xa)?e.WebimPresenceType.dnd:n.some(t=>t.show===e.PresenceShow.dnd&&t.status===e.PresenceStatus.Presenting)||s.some(t=>t.show===e.PresenceShow.dnd&&t.status===e.PresenceStatus.Presenting)||o.some(t=>t.show===e.PresenceShow.dnd&&t.status===e.PresenceStatus.Presenting)||i.some(t=>t.show===e.PresenceShow.dnd&&t.status===e.PresenceStatus.Presenting)?e.WebimPresenceType.presenting:n.some(t=>t.show===e.PresenceShow.dnd&&t.status===e.PresenceStatus.ZoomMeeting)||s.some(t=>t.show===e.PresenceShow.dnd&&t.status===e.PresenceStatus.ZoomMeeting)||o.some(t=>t.show===e.PresenceShow.dnd&&t.status===e.PresenceStatus.ZoomMeeting)||i.some(t=>t.show===e.PresenceShow.dnd&&t.status===e.PresenceStatus.ZoomMeeting)?e.WebimPresenceType.zoommeeting:n.some(t=>t.show===e.PresenceShow.dnd&&t.status===e.PresenceStatus.Pbx)||s.some(t=>t.show===e.PresenceShow.dnd&&t.status===e.PresenceStatus.Pbx)||o.some(t=>t.show===e.PresenceShow.dnd&&t.status===e.PresenceStatus.Pbx)||i.some(t=>t.show===e.PresenceShow.dnd&&t.status===e.PresenceStatus.Pbx)?e.WebimPresenceType.pbx:n.some(t=>t.show===e.PresenceShow.dnd&&t.status===e.PresenceStatus.Meeting)||s.some(t=>t.show===e.PresenceShow.dnd&&t.status===e.PresenceStatus.Meeting)||o.some(t=>t.show===e.PresenceShow.dnd&&t.status===e.PresenceStatus.Meeting)||i.some(t=>t.show===e.PresenceShow.dnd&&t.status===e.PresenceStatus.Meeting)?e.WebimPresenceType.calendar:n.some(t=>t.show===e.PresenceShow.away&&t.status===e.PresenceStatus.Busy)||s.some(t=>t.show===e.PresenceShow.away&&t.status===e.PresenceStatus.Busy)||o.some(t=>t.show===e.PresenceShow.away&&t.status===e.PresenceStatus.Busy)||i.some(t=>t.show===e.PresenceShow.away&&t.status===e.PresenceStatus.Busy)?e.WebimPresenceType.busy:n.some(t=>t.show===e.PresenceShow.online)?e.WebimPresenceType.available:n.some(t=>t.show===e.PresenceShow.away)?e.WebimPresenceType.away:s.some(t=>t.show===e.PresenceShow.online)||o.some(t=>t.show===e.PresenceShow.online)||i.some(t=>t.show===e.PresenceShow.online)?e.WebimPresenceType.mobile:(i.some(t=>t.show===e.PresenceShow.away)||n.some(t=>t.show===e.PresenceShow.offline)||s.some(t=>t.show===e.PresenceShow.offline)||o.some(t=>t.show===e.PresenceShow.offline)||i.some(t=>t.show===e.PresenceShow.offline),e.WebimPresenceType.offline)},this.getPresenceResourceWithManuallySetPresence=e=>e.map(e=>e.filter(e=>e.isManual)),this.onUnreadChatMessageCount=t=>{this.dispatch({type:e.WebimEventType.UnreadChatMessageCount,data:t})},this.connection=n.connection,this.dispatch=n.dispatch,this.presencesMap=new Map,this.deviceList=[],this.inviteContactResolve=q,this.deleteContactResolve=q}init(){var e,t,n,s,o,i,r,c,a,l,d;B.debug("init"),null==(e=this.connection)||null==(t=e.zConnection)||t.iqpresence.addIQPresenceCB(this.onIqPresenceChange),null==(n=this.connection)||null==(s=n.zConnection)||s.iqpresence.addIQDeviceCB(this.onReciveDeviceList),null==(o=this.connection)||null==(i=o.zConnection)||i.presence.addPresenceHandle(this.onPresenceChange),null==(r=this.connection)||null==(c=r.zConnection)||c.presence.addRosterHandle(this.onRosterListChange),null==(a=this.connection)||null==(l=a.zConnection)||l.iqpresence.addUnreadChatMessageCountCB(this.onUnreadChatMessageCount),null==(d=this.connection)||d.zConnection.presencePolicy.addPresencePolicyCB(this.onPresencePolicyChange)}uninit(){var e,t,n,s,o,i,r,c,a,l;B.debug("uninit"),null==(e=this.connection)||null==(t=e.zConnection)||t.iqpresence.addIQPresenceCB(null),null==(n=this.connection)||null==(s=n.zConnection)||s.presence.addPresenceHandle(null),null==(o=this.connection)||null==(i=o.zConnection)||i.iqpresence.addIQDeviceCB(null),null==(r=this.connection)||null==(c=r.zConnection)||c.presence.addIQHandle(null),null==(a=this.connection)||null==(l=a.zConnection)||l.presence.addRosterHandle(null)}changePresence(t,n,s){switch(t){case e.WebimPresenceType.ooo:this.outofoffice(n);break;case e.WebimPresenceType.offline:this.offline();break;case e.WebimPresenceType.zoommeeting:this.inMeeting(s);break;case e.WebimPresenceType.presenting:this.inPresenting(s);break;case e.WebimPresenceType.available:this.online(n);break;case e.WebimPresenceType.pbx:this.inPhoneCall();break;case e.WebimPresenceType.away:this.away(n);break;case e.WebimPresenceType.dnd:this.dnd();break;case e.WebimPresenceType.busy:this.busy(n)}}getPresenceType(t){if(!t)return null;const n=Object.values(t),s=[n.filter(t=>t.resource.startsWith(e.XmppResources.pc)),n.filter(t=>t.resource.startsWith(e.XmppResources.mobile)),n.filter(t=>t.resource.startsWith(e.XmppResources.pad)),n.filter(t=>t.resource.startsWith(e.XmppResources.pzr))],o=this.getPresenceResourceWithManuallySetPresence(s);return o.flat().length>0?this.determinePresenceType(o):this.determinePresenceType(s)}online(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t,n;null==(t=this.connection)||null==(n=t.zConnection)||n.presence.online(e)}offline(){var e,t;null==(e=this.connection)||null==(t=e.zConnection)||t.presence.offline()}inMeeting(e){var t,n;null==(t=this.connection)||null==(n=t.zConnection)||n.presence.inMeeting(e)}inPresenting(e){var t,n;null==(t=this.connection)||null==(n=t.zConnection)||n.presence.inPresenting(e)}inPhoneCall(){var e,t;null==(e=this.connection)||null==(t=e.zConnection)||t.presence.inPhoneCall()}away(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t,n;null==(t=this.connection)||null==(n=t.zConnection)||n.presence.away(e)}duration(e){var t,n;null==(t=this.connection)||null==(n=t.zConnection)||n.presence.duration(e)}outofoffice(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t,n;null==(t=this.connection)||null==(n=t.zConnection)||n.presence.outofoffice(e)}dnd(){var e,t;null==(e=this.connection)||null==(t=e.zConnection)||t.presence.dnd()}busy(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t;null==(t=this.connection)||t.zConnection.presence.busy(e)}queryDevice(){var e,t;null==(e=this.connection)||null==(t=e.zConnection)||t.iqpresence.queryDevice()}inviteContactByEmail(e){var t,n;return null==(t=this.connection)||null==(n=t.zConnection)||n.presence.inviteContactByEmail(e),new Promise(e=>{this.inviteContactResolve=e})}deleteContactByJid(e){var t,n;return null==(t=this.connection)||null==(n=t.zConnection)||n.presence.deleteContactByJid(e),new Promise(e=>{this.deleteContactResolve=e})}}const L=new j(e.WebimModuleName.message);class W{constructor(n){var o=this;this._recentChatList=void 0,this.connection=void 0,this.dispatch=void 0,this.onMessageHanlder=t=>{const{zmext:n,zext_call:s,zmsync:o,inviteContactSyncMessage:i,delay:r}=t;if(n&&!r){var c,a;const{time:e,from:t}=n;null==(c=this.connection)||null==(a=c.zConnection)||a.ackmessage.ack(e,t)}var l,d;s&&this.dispatch({type:e.WebimEventType.MessageChange,data:s}),o&&o.type===E.SyncLoginInfo&&(null==(l=this.connection)||null==(d=l.zConnection)||d.iqpresence.queryDevice(),this.dispatch({type:e.WebimEventType.LoginOtherDevice})),i&&this.dispatch({type:e.WebimEventType.InviteContactSyncMessage,data:i})},this.onRecentChatHandler=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];o.dispatch({type:e.WebimEventType.RecentChat,data:t})},this.sendMessage=e=>{var t,n;return null==(t=this.connection)||null==(n=t.zConnection)?void 0:n.Messaging.sendMessage(e)},this.composeInvitationMessage=e=>{let{mid:n,action:o="",fromJid:i="",toJid:r="",fromName:c="",raw:a="",srcDeviceId:l="",caption:d="",dstDeviceId:u="",name:m="",type:p="chat",notifyOtherDevices:f=0,subType:y,msgType:v}=e;const g={"@xmlns":t.Strophe.NS.CLIENT,"@from":i,"@type":p,"@to":r,active:{"@xmlns":s.CHATSTATES},zmext:{obj:{"@f":6,"@st":0},from:{"@n":c,"@res":h.resouceId},to:"",visible:!1},zext_call:{action:o,raw:a,src_deviceid:l,caption:d,notify_other_devices:f,mid:n},zmtask:{"@feature":3}};return u&&(g.zext_call.dst_deviceid=u),"groupchat"===p&&(g.zext_call.group_name=m),void 0!==y&&(g.zext_call.subtype=y),void 0!==v&&(g.zmext.msg_type=v),g},this.sendInviteContactSyncMessage=e=>{var t,n;const s=this.composeInviteContactSyncMessage(e);return null==(t=this.connection)||null==(n=t.zConnection)?void 0:n.Messaging.sendInviteContactSyncMessage({message:s})},this._recentChatList=[],this.connection=n.connection,this.dispatch=n.dispatch}init(){var e,t,n,s;L.debug("message -> init"),null==(e=this.connection)||null==(t=e.zConnection)||t.Messaging.addMessageCB(this.onMessageHanlder),null==(n=this.connection)||null==(s=n.zConnection)||s.Messaging.addRecentChatCB(this.onRecentChatHandler)}uninit(){var e,t,n,s;L.debug("message -> uninit"),null==(e=this.connection)||null==(t=e.zConnection)||t.Messaging.addMessageCB(null),null==(n=this.connection)||null==(s=n.zConnection)||s.Messaging.addRecentChatCB(null)}onConnectionChange(){}invite(e){var t,n;L.debug("message -> invite",e);const{jid:s,mid:o,meetingNo:i,password:r,displayName:c,caption:a,toJid:l,iak:d,credential:u,type:h,name:m}=e,p=null==(t=this.connection)||null==(n=t.zConnection)?void 0:n.deviceId,f=this.formatInvitationRaw({meetingNo:i,nsCommand:0,userId:s,screenName:c,password:r,iak:d,credential:u}),y=this.composeInvitationMessage({mid:o,fromJid:s,toJid:l,fromName:c,action:I.Invite,raw:f,srcDeviceId:p,caption:a,type:h,name:m,msgType:55});return this.sendMessage({message:y})}acceptInvitation(e){var t,n;L.debug("message -> invite","accept invitation",e);const{meetingNo:s,mid:o,toJid:i,toName:r=""}=e,c=null==(t=this.connection)||null==(n=t.zConnection)?void 0:n.deviceId;let a={meetingNo:s,meetingOption:6,nsCommand:2,userId:i,deviceId:c};a=this.formatInvitationRaw(a);let l={action:I.Accept,mid:o,fromJid:i.split("/")[0],toJid:i,raw:a,fromName:r,srcDeviceId:c,notifyOtherDevices:1};l=this.composeInvitationMessage(l),this.sendMessage({message:l})}declineInvitation(e){var t,n;L.debug("message -> invite","decline invitation",e);const{meetingNo:s,mid:o,fromJid:i,toJid:r,toName:c="",isTimeoutDecline:a}=e,l=null==(t=this.connection)||null==(n=t.zConnection)?void 0:n.deviceId;let d={meetingNo:s,meetingOption:6,nsCommand:3,userId:r,deviceId:l};d=this.formatInvitationRaw(d);let u={action:I.Decline,fromJid:r,mid:o,toJid:i,raw:d,fromName:c,srcDeviceId:l,notifyOtherDevices:1};a&&(u.subType=1),u=this.composeInvitationMessage(u),this.sendMessage({message:u})}cancelInvitation(e){var t,n;L.debug("message -> invite","cancel invitation",e);const{meetingNo:s,mid:o,jid:i,toJid:r,toName:c="",name:a,type:l}=e,d=null==(t=this.connection)||null==(n=t.zConnection)?void 0:n.deviceId;let u={meetingNo:s,meetingOption:6,nsCommand:4,userId:i,deviceId:d};u=this.formatInvitationRaw(u);let h={action:"cancel",mid:o,fromJid:i,toJid:r,raw:u,name:a,type:l,fromName:c,srcDeviceId:d,notifyOtherDevices:1};h=this.composeInvitationMessage(h),this.sendMessage({message:h})}queryRecentChat(){var e,t;null==(e=this.connection)||null==(t=e.zConnection)||t.Messaging.queryRecentChat()}getRecentChatList(){return this._recentChatList.slice()}formatReceivedInvitationMessage(e){const{zext_call:{mid:t,action:n,caption:s,raw:o,src_deviceid:i,subtype:r,lcp:c},zmext:{from:{_res:a},_expire_t:l=-1,_t:d=-1},delay:u,_from:h,_to:m}=e,p=o.split(";"),f=p[2]||"",y=p[3]||0,v=p[7]||"";return{action:n,mid:t,meetingNo:f,meetingOption:y,password:p[8]||"",caption:s,fromJid:h,fromName:v,fromResource:a,fromDeviceId:i,isTimeoutDecline:r,toJid:m,expireTime:l,receiveTime:d,delay:u,__raw__:o,iak:p[15]||"",credential:p[16]||"",lcp:c}}formatInvitationRaw(e){let{meetingNo:t,nsCommand:n,userId:s,screenName:o="",deviceId:i="",password:r="",meetingOption:c="",scheduleOption:a="",isPhoneCall:l="",callId:d="",groupName:u="",groupMemberCount:h="",groupId:m="",iak:p="",credential:f=""}=e;return o=o.replace(/;/g,","),["","",t,c,n,s,i,o,r,a,l,d,u,h,m,p,f].join(";")}handleInviteContactReceivedSyncMessage(t){const{zext_subsync:{_action:n,peerjid:s,peername:o,_peeremail:i}}=t;this.dispatch({type:e.WebimEventType.InviteContactSyncMessage,data:{action:n,jid:s,name:o,email:i,message:t}})}composeInviteContactSyncMessage(e){const{action:n,inviteeJid:o,inviteeEmail:i,inviteeName:r,inviterName:c}=e;return{active:{"@xmlns":s.CHATSTATES},zmext:{from:{"@n":c,"@res":""},msg_type:"201",to:"",visible:"false"},zext_subsync:{"@xmlns":"zoom:sub:ext","@action":n,"@peerjid":o,"@peername":r,"@peeremail":i,"@error":"0","@extension":"0"},zmtask:{"@xmlns":"zoom:imcmd","@feature":"4099"},"@xmlns":t.Strophe.NS.CLIENT,"@from":"","@to":"","@id":"","@type":"chat"}}}const U="default",H=new j(e.WebimModuleName.roster);class V{constructor(t){this.groupsMap=void 0,this.contactsMap=void 0,this.connection=void 0,this.dispatch=void 0,this.onConnectionChange=t=>{t.status===e.WebimStatus.CONNECTED&&this.queryGroupVersion()},this.queryGroupVersion=()=>{var e,t;H.debug("roster -> query group version"),null==(e=this.connection)||null==(t=e.zConnection)||t.roster.queryGroupInfos()},this.queryNextRosterPage=e=>{var t,n;/:\d+$/.test(e)&&(null==(t=this.connection)||null==(n=t.zConnection)||n.roster.queryChunk(e))},this.fetchBlockList=()=>{var e,t;return null==(e=this.connection)||null==(t=e.zConnection)?void 0:t.roster.fetchBlockList()},this.zStropherRosterHandler=(e,t)=>{if(e===R.ROSTER_VERSION_CB&&this.onGetGroupVersionFromServer(t),e===R.ROSTER_ITEMS_CB){const{chunk:e,group:n,groups:s=[]}=t;this.onGetRosterFromServer(n?[n,...s]:s),this.queryNextRosterPage(e)}e===R.ROSTER_BLOCKED_LIST&&this.onGetBlockedRosterList(t)},this.onGetGroupVersionFromServer=t=>{this.dispatch({type:e.WebimEventType.ServerGroups,data:t})},this.onGetRosterFromServer=e=>{if(0===e.length)return;const t=[];e.forEach(e=>{let{id:n=U,version:s,name:o,total:i,first:r,option:c,items:a}=e;o||(o=a&&a[0]&&a[0].gname?`${a[0].gname}##${P.Default}##${n}`:`${n}##${P.Default}##${n}`);const[l,d,u]=this.formatGroupName(o);let h=this.groupsMap.get(u);h&&!r||(h={id:u,type:d,name:l,total:i,option:c,version:s,items:[]});const m=[];null==a||a.forEach(e=>{var t;const{fname:n,lname:s,jid:o,type:i,cmd:r}=e;null==(t=h)||t.items.push(o),this.contactsMap.set(o,Object.assign({},this.contactsMap.get(o),{jid:o,type:i,cmd:r,fname:n,lname:s})),m.push(o)}),H.debug("roster -> receive group member chunk",l,h),this.groupsMap.set(u,h),t.push([u,m])}),this.notifyGroupChange(t)},this.formatGroupName=e=>{const t=e.match(/^(.+)##(.+)##(.+)$/);if(t){const[e,n,s,o]=t;return[n,s,o]}return e.split("##")},this.notifyGroupChange=t=>{if(H.debug("roster -> notify group change",t),0===t.length)return;const n=t.map(e=>{let[t,n]=e;const s=this.groupsMap.get(t);if(!s)return null;const o=n.map(e=>this.transformRosterToContact(this.contactsMap.get(e))).filter(e=>null!==e);return{...s,items:o}}).filter(e=>e);this.dispatch({type:e.WebimEventType.GroupChange,data:n})},this.onGetBlockedRosterList=t=>{this.dispatch({type:e.WebimEventType.RosterBlocklist,data:t})},this.transformRosterToContact=e=>{if(!e)return null;const{jid:t,type:n=N.Normal,fname:s="",lname:o="",cmd:i=""}=e;return{jid:t,type:n,cmd:i,firstName:s,lastName:o}},this.groupsMap=new Map,this.contactsMap=new Map,this.connection=t.connection,this.dispatch=t.dispatch}init(){var e,t;H.debug("roster -> init"),null==(e=this.connection)||null==(t=e.zConnection)||t.roster.addRosterHandler(this.zStropherRosterHandler)}uninit(){var e,t;H.debug("roster -> uninit"),null==(e=this.connection)||null==(t=e.zConnection)||t.roster.addRosterHandler(null)}queryGroupMember(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;var s,o;H.debug("roster -> query group member",e),e.length>0&&(null==(s=this.connection)||null==(o=s.zConnection)||o.roster.queryGroups({groups:e,chunk:t,directory:n}))}}const G=new j(e.WebimModuleName.vcard);class J{constructor(t){this.connection=void 0,this.dispatch=void 0,this.vcardsMap=void 0,this.init=()=>{var e,t;G.debug("vcard init"),null==(e=this.connection)||null==(t=e.zConnection)||t.vcard.addVCardHandler(this.onVcardChangeHandler)},this.uninit=()=>{var e,t;G.debug("vcard uninit"),null==(e=this.connection)||null==(t=e.zConnection)||t.vcard.addVCardHandler(null)},this.onVcardChangeHandler=e=>{const{action:t,data:n}=e;switch(t){case w.QUERY:const{jid:e}=n;this.vcardsMap.set(e,Object.assign({},this.vcardsMap.get(e),n)),this.notifyVcardChange([e]);case w.UPDATE:}},this.notifyVcardChange=t=>{this.dispatch({type:e.WebimEventType.VcardChange,data:t.map(e=>({...this.vcardsMap.get(e)})).filter(e=>e)})},this.queryVcard=e=>{let{jid:t,forceFetch:n=!1}=e;if(!t)return;let s=this.vcardsMap.get(t);s||(s={jid:"",displayName:"",lastName:"",firstName:"",picUrl:"",email:"",organization:{id:"",domain:""},signature:"",phone:{sip:"",normal:"",work:"",home:""},lastQueryTime:-1},this.vcardsMap.set(t,s));const{queryVcardInterval:o}=h,i=s.lastQueryTime;return Date.now()-i>=o||n?this.queryVcardFromServer(t):{...s}},this.queryAllVcardsByForce=()=>{Array.from(this.vcardsMap.keys()).forEach(e=>{this.queryVcardFromServer(e)})},this.queryVcardFromServer=e=>{const{xmppToken:t}=h,{secret:n}=this.connection||{};if(t&&n){var s,o;const t=this.vcardsMap.get(e);t&&(t.lastQueryTime=Date.now(),this.vcardsMap.set(e,t)),null==(s=this.connection)||null==(o=s.zConnection)||o.vcard.query(e)}},this.getVcard=e=>e&&{...this.vcardsMap.get(e)},this.onConnectionChange=t=>{e.WebimStatus.CONNECTED===t.status&&this.queryAllVcardsByForce()},this.connection=t.connection,this.dispatch=t.dispatch,this.vcardsMap=new Map}}const Q=new j(e.WebimModuleName.room);class Z{constructor(e){this.connection=void 0,this.dispatch=void 0,this.requestedMap=void 0,this.init=()=>{var e,t;Q.debug("room init"),null==(e=this.connection)||null==(t=e.zConnection)||t.room.addRoomHandler(this.onRoomHandler)},this.uninit=()=>{var e,t;Q.debug("vcard uninit"),null==(e=this.connection)||null==(t=e.zConnection)||t.room.addRoomHandler(null)},this.onConnectionChange=()=>{},this.unhideRoom=e=>{var t,n;const s=null==(t=this.connection)||null==(n=t.zConnection)?void 0:n.room.changeRoomOption(e,{option:"0",e2e:"0",desc:"",announcer:"",unhidden:1});return s?new Promise((e,t)=>{this.requestedMap.set(s,{resolve:e,reject:t})}).finally(()=>{this.requestedMap.delete(s)}):Promise.reject("internal error")},this.onRoomHandler=e=>{const{id:t,type:n,data:s}=e,o=this.requestedMap.get(t);if(o){const{resolve:e,reject:t}=o;"result"===n?e(s):t("error")}},this.connection=e.connection,this.dispatch=e.dispatch,this.requestedMap=new Map}}const F=new j(e.WebimModuleName.contact);class X{constructor(t){this.connection=void 0,this.dispatch=void 0,this.onConnectionChange=()=>{},this.handleReceiveStarOrUnStarContact=(t,n)=>{this.dispatch({type:e.WebimEventType.staredContacts,data:{contacts:t,operation:n}})},this.connection=t.connection,this.dispatch=t.dispatch}init(){var e,t;F.debug("init"),null==(e=this.connection)||null==(t=e.zConnection)||t.contact.addStarOrUnStarContactHandle(this.handleReceiveStarOrUnStarContact)}uninit(){var e,t;F.debug("uninit"),null==(e=this.connection)||null==(t=e.zConnection)||t.contact.addStarContactHandle(null)}fetchStarredContacts(){var e,t;null==(e=this.connection)||null==(t=e.zConnection)||t.contact.fetchStarredContacts()}async starOrUnStarContact(e,t){var n,s;return null==(n=this.connection)||null==(s=n.zConnection)?void 0:s.contact.starOrUnStarContact(e,t)}}class ${get isConnected(){return this.statusInfo.status===e.WebimStatus.CONNECTED}get isDisconnected(){return this.statusInfo.status===e.WebimStatus.DISCONNECTED}constructor(n){let{dispatch:s,deviceName:o}=n;this.statusInfo={status:e.WebimStatus.INIT,statusInfo:"",networkConnected:navigator.onLine,willReconnect:!0},this.moduleMap=void 0,this.dispatch=void 0,this.zConnection=void 0,this.secret=void 0,this.syncTime=void 0,this.deviceName=void 0,this.connect=()=>{this.statusInfo.status===e.WebimStatus.INIT&&this.doConnect()},this.doConnect=()=>{var e;const{jid:t,xmppToken:n,web:{option:s},resouceId:o,deviceId:i}=h,r={jid:`${t}/${o}`,pass:n,deviceId:i||(e=>{const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});return"string"==typeof e||"number"==typeof e?t+":"+e:t+""})(this.deviceName||""),deviceName:this.deviceName,featureOption:s};null==(e=this.zConnection)||e.connect2(r)},this.disconnect=()=>{this.doDisconnect(),this.uninit()},this.doDisconnect=()=>{try{var e;null==(e=this.zConnection)||e.destroyManually()}catch(e){}},this.onZStropheStatusChange=(n,s)=>{let o=(e=>{const t=Object.entries(e).map(e=>{let[t,n]=e;return{[n]:t}});return Object.assign({},...t)})(t.Strophe.Status)[n];const i=s;o===e.WebimStatus.CONNECTING&&this.statusInfo.status!==e.WebimStatus.INIT&&(o=e.WebimStatus.RECONNECTING),o===e.WebimStatus.CONNECTED&&(this.secret=this.zConnection.secret,this.syncTime={serverTime:this.zConnection.serverTime,localTime:Date.now()}),this.statusInfo.status=o,this.statusInfo.statusInfo=i,Object.values(this.moduleMap).forEach(e=>e.onConnectionChange(this.statusInfo)),this.dispatch({type:e.WebimEventType.ConnectionStatusChange,data:{...this.statusInfo}})},this.dispatch=s,this.secret="",this.syncTime={serverTime:-1,localTime:-1},this.deviceName=o;const i={connection:this,dispatch:s};this.moduleMap={roster:new V(i),vcard:new J(i),presence:new k(i),message:new W(i),room:new Z(i),contact:new X(i)},this.init()}init(){var e;const{XMPPServer:n}=h;this.zConnection=new t.Strophe.Connection(n,{},{enableHandlerParseXmlToJson:!0,enableCacheReceivedMessages:!1,enableReplayReceivedMessages:!1}),null==(e=this.zConnection)||e.eventBus.on(t.EVENT_BUS.CONNECT_STATUS,e=>{const{status:t,condition:n}=e;this.onZStropheStatusChange(t,n)}),Object.values(this.moduleMap).forEach(e=>e.init())}uninit(){Object.values(this.moduleMap).forEach(e=>e.uninit()),this.zConnection&&(this.zConnection.connect_callback=null),this.zConnection=null}getCurrentStatusInfo(){return Object.assign({},this.statusInfo)}}f(function(e,t){var n;e.exports=(n=v,function(e){var t=n,s=t.lib,o=s.WordArray,i=s.Hasher,r=t.algo,c=[],a=[];!function(){function t(t){for(var n=e.sqrt(t),s=2;s<=n;s++)if(!(t%s))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var s=2,o=0;o<64;)t(s)&&(o<8&&(c[o]=n(e.pow(s,.5))),a[o]=n(e.pow(s,1/3)),o++),s++}();var l=[],d=r.SHA256=i.extend({_doReset:function(){this._hash=new o.init(c.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,s=n[0],o=n[1],i=n[2],r=n[3],c=n[4],d=n[5],u=n[6],h=n[7],m=0;m<64;m++){if(m<16)l[m]=0|e[t+m];else{var p=l[m-15],f=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,y=l[m-2],v=(y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10;l[m]=f+l[m-7]+v+l[m-16]}var g=s&o^s&i^o&i,C=(s<<30|s>>>2)^(s<<19|s>>>13)^(s<<10|s>>>22),S=h+((c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25))+(c&d^~c&u)+a[m]+l[m];h=u,u=d,d=c,c=r+S|0,r=i,i=o,o=s,s=S+(C+g)|0}n[0]=n[0]+s|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+r|0,n[4]=n[4]+c|0,n[5]=n[5]+d|0,n[6]=n[6]+u|0,n[7]=n[7]+h|0},_doFinalize:function(){var t=this._data,n=t.words,s=8*this._nDataBytes,o=8*t.sigBytes;return n[o>>>5]|=128<<24-o%32,n[14+(o+64>>>9<<4)]=e.floor(s/4294967296),n[15+(o+64>>>9<<4)]=s,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=i._createHelper(d),t.HmacSHA256=i._createHmacHelper(d)}(Math),n.SHA256)}),f(function(e,t){var n,s,o;e.exports=(s=(n=v).lib.Base,o=n.enc.Utf8,void(n.algo.HMAC=s.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=o.parse(t));var n=e.blockSize,s=4*n;t.sigBytes>s&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),r=this._iKey=t.clone(),c=i.words,a=r.words,l=0;l<n;l++)c[l]^=1549556828,a[l]^=909522486;i.sigBytes=r.sigBytes=s,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})))});var K=f(function(e,t){e.exports=v.HmacSHA256});const Y=new j(e.WebimModuleName.xms);class ee{constructor(e){let{tokenUrl:t,secret:n}=e;this.tokenUrl="",this.secret="",this.zckToken="",this.refreshTokenPromise=null,this.setSecret=e=>{this.secret=e},this.fetchToken=e=>this.tokenUrl?window.fetch(this.tokenUrl,{method:"post",headers:{"content-type":"application/x-www-form-urlencoded"},body:"type=xms"}).catch(()=>Promise.reject({errorCode:-1,errorMsg:"Network Error"})).then(e=>e.ok?e.json():Promise.reject({errorCode:e.status,errorMsg:e.statusText})).then(e=>{const{errorCode:t,result:n}=e;return 201===t?Promise.reject({errorCode:201,errorMsg:M}):0===t&&null!=n&&n.xmsPWAZCK?n.xmsPWAZCK:Promise.reject({errorCode:t,errorMsg:e.errorMsg||JSON.stringify(e)})}).then(e=>{this.zckToken=e}).catch(e=>{throw Y.error("getXMSToken error ==>",e),this.zckToken="",e}):Promise.reject(new Error("tokenUrl is empty")),this.refreshToken=e=>(this.refreshTokenPromise||(this.refreshTokenPromise=this.fetchToken(e)),this.refreshTokenPromise.finally(()=>{this.refreshTokenPromise=null})),this.handleResponseOk=e=>e.ok&&200===e.status?Promise.resolve(e.json()):Promise.reject(e),this.handleResponseFail=e=>e?e.ok?Promise.reject({errorCode:e.status,errorMsg:JSON.stringify(e.json())}):Promise.reject({errorCode:e.status,errorMsg:e.statusText}):Promise.reject({errorCode:-1,errorMsg:"Network Error"}),this.fetch=(e,t)=>{if(!this.secret)return Promise.reject("empty secret");const n=()=>{const n=((e,t,n)=>{const s=Date.now(),o=`timestamp=${s.toString()}:${JSON.stringify(e)}`,i=K(o,n);return{zck:t,"XMS-Timestamp":s,"XMS-Hash":C.stringify(i)}})(t.body,this.zckToken,this.secret),s={method:t.method||"post",headers:Object.assign({"Content-Type":"application/json;charset=UTF-8"},t.headers,n),body:JSON.stringify(t.body)};return window.fetch(e,s).then(this.handleResponseOk).catch(this.handleResponseFail)};return!this.zckToken||this.refreshTokenPromise?this.refreshToken().then(()=>n()):n().catch(e=>{if(490===e.errorCode)return this.refreshToken().then(()=>n());throw e})},this.tokenUrl=t,this.secret=n,this.refreshTokenPromise=null}}const te=new j(e.WebimModuleName.xms);class ne{constructor(e){let{tokenUrl:n,secret:s,xmsDomain:o}=e;this.vcardsMap=new Map,this.httpRequest=void 0,this.xmsDomain="",this.filterJidIfDataCache=(e,t)=>e.filter(e=>{const{jid:n}=e,s=this.vcardsMap.get(n);if(!s)return!0;const{queryVcardInterval:o}=h,i=s.lastQueryTime;return!!(Date.now()-i>=o||t)}),this.fetchContactProfile=e=>{const{jidParams:n,forceFetch:s=!1}=e,{jids:o}=n,i=this.filterJidIfDataCache(o,s);if(0===i.length)return te.debug("vcardsMap has cached, need not request"),Promise.resolve([]);te.debug("filter forceFetch ==>",s),te.debug("filter queryJids ==>",i);const r={body:{jids:i}};return this.httpRequest.fetch(`https://${this.xmsDomain}/xms/vcard/fetch`,r).then(e=>{te.debug("fetchContactProfile result ==>",e);const{data:n}=e;return n&&Array.isArray(n)?n.map(e=>{const{vcard:n,jid:s}=e;if(s&&this.vcardsMap.set(s,{...e,lastQueryTime:Date.now()}),!n)return e;const o=t.xml2json(n),i=o.vCard?A(o):{};return{...e,vcard:i}}):Promise.reject(JSON.stringify(e))}).catch(e=>{throw e})},this.checkMemberIsInGroup=e=>{const t={body:e};return this.httpRequest.fetch(`https://${this.xmsDomain}/xms/channel/memberIsInGroup`,t).then(e=>{te.debug("checkMemberIsInGroup result ==>",e);const{data:t}=e;return t&&Array.isArray(t)?t:Promise.reject(JSON.stringify(e))}).catch(e=>{throw e})},this.fetchRecentChats=()=>this.httpRequest.fetch(`https://${this.xmsDomain}/xms/channel/recentChats`,{body:{}}).then(e=>{te.debug("fetchRecentChats result ==>",e);const{data:t}=e;return t||Promise.reject(JSON.stringify(e))}).catch(e=>{throw e}),this.checkAlreadyContact=e=>{const n={body:e};return this.httpRequest.fetch(`https://${this.xmsDomain}/xms/vcard/fetch/byEmail`,n).then(e=>{te.debug("checkAlreadyContact response ==>",e);const{result:n,data:s}=e;return 0===n&&Array.isArray(s)&&s.length>0?s.map(e=>{const{vcard:n}=e,s=A(t.xml2json(n))||{};return{...e,vcard:s}}):Promise.reject(JSON.stringify(e))}).catch(e=>{throw e})},this.checkContactByJids=e=>{const t={body:e};return this.httpRequest.fetch(`https://${this.xmsDomain}/xms/pcontact/canContact`,t).then(e=>{te.debug("checkAlreadyContact response ==>",e);const{result:t,data:n}=e;return 0===t&&Array.isArray(n)?n:Promise.reject(JSON.stringify(e))}).catch(e=>{throw e})},this.xmsDomain=o,this.httpRequest=new ee({tokenUrl:n,secret:s})}}e.WEB_SESSION_EXPIRED_ERROR=M,e.default=function(t){var n,s;Object.assign(h,t),j.setLogLevels(null==(n=h.log)?void 0:n.logLevel),j.setLogModules(null==(s=h.log)?void 0:s.logModule);const o={all:i=i||new Map,on:function(e,t){var n=i.get(e);n&&n.push(t)||i.set(e,[t])},off:function(e,t){var n=i.get(e);n&&n.splice(n.indexOf(t)>>>0,1)},emit:function(e,t){(i.get(e)||[]).slice().map(function(e){e(t)}),(i.get("*")||[]).slice().map(function(n){n(e,t)})}};var i;const r=(e,t,n)=>new Promise((s,o)=>{const{isConnected:i,secret:r}=e;if(!i||!r)return o(`ERROR:: connection isConnected: ${e.isConnected}, connection secret: ${e.secret}`);const{PWATokenUrl:c,XMSDomain:a}=t;return c&&a?(n.httpRequest.secret||n.httpRequest.setSecret(r),s(!0)):o(`ERROR:: PWATokenUrl: ${c}, XMSDomain: ${a}`)}),c=new $({dispatch:t=>{t.type,e.WebimEventType.GroupChange,t.type,e.WebimEventType.PresenceChange,t.type,e.WebimEventType.VcardChange,t.type,e.WebimEventType.MessageChange,o.emit(t.type,t)},deviceName:null==t?void 0:t.deviceName}),{vcard:l,presence:d,message:u,roster:m,room:p,contact:f}=c.moduleMap,y=new ne({tokenUrl:h.PWATokenUrl,secret:c.secret,xmsDomain:h.XMSDomain});return{on(e,t){o.on(e,t)},off(e,t){o.off(e,t)},clear(){o.all.clear()},getCurrentStatus:()=>c.getCurrentStatusInfo().status,connect(e){Object.assign(h,e),c.connect()},disconnect(){c.disconnect()},getAllPresencePocliies(){var e;const t=null==c||null==(e=c.zConnection)?void 0:e.presencePolicy;t&&(t.getDndPolicy(),t.getBusyPolicy(),t.getOOOPolicy(),t.getSnoozePolicy())},setPresencePolicy(e){var t;const n=null==c||null==(t=c.zConnection)?void 0:t.presencePolicy;n&&(a.dnd===e.name&&n.setDndPolicy(e.value.from,e.value.to),a.snooze===e.name&&n.setSnoozePolicy(e.value.from,e.value.to,e.value.duration),a.ooo===e.name&&n.setOOOPolicy(e.value.duration),a.busy===e.name&&n.setBusyPolicy(e.value.duration))},changePresence:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;return c.isConnected?d.changePresence(e,t,n):null},queryVcard:e=>c.isConnected?l.queryVcard(e):null,invite:e=>c.isConnected?u.invite(e):null,cancelInvitation:e=>c.isConnected?u.cancelInvitation(e):null,declineInvitation:e=>c.isConnected?u.declineInvitation(e):null,acceptInvitation:e=>c.isConnected?u.acceptInvitation(e):null,queryRecentChat:()=>c.isConnected?u.queryRecentChat():null,getGroupMembers:e=>c.isConnected?m.queryGroupMember(e):null,getContactProfile:async e=>r(c,t,y).then(()=>y.fetchContactProfile(e)).catch(e=>Promise.reject(e)),checkMemberIsInGroup:async e=>r(c,t,y).then(()=>y.checkMemberIsInGroup(e)).catch(e=>Promise.reject(e)),getRecentChats:async()=>r(c,t,y).then(()=>y.fetchRecentChats()).catch(e=>Promise.reject(e)),checkAlreadyContact:async e=>r(c,t,y).then(()=>y.checkAlreadyContact(e)).catch(e=>Promise.reject(e)),unhideRoom:e=>c.isConnected?p.unhideRoom(e):Promise.reject("disconnected"),fetchBlockList:()=>m.fetchBlockList(),queryDevices:()=>c.isConnected?d.queryDevice():null,requestLcp(e,t,n,s,o){var i;return c.isConnected?null==c||null==(i=c.zConnection)?void 0:i.Messaging.requestLcp(e,t,n,s,o):null},inviteContactByEmail:e=>d.inviteContactByEmail(e),deleteContactByJid:e=>d.deleteContactByJid(e),sendInviteContactSyncMessage:e=>c.isConnected?u.sendInviteContactSyncMessage(e):null,sendLcp(e,t,n,s,o,i){var r;return c.isConnected?null==c||null==(r=c.zConnection)?void 0:r.Messaging.sendLcp(e,t,n,s,o,i):null},checkContactByJids:async e=>r(c,t,y).then(()=>y.checkContactByJids(e)).catch(e=>Promise.reject(e)),getStropheInstance:()=>c.zConnection,starOrUnStarContact:async(e,t)=>f.starOrUnStarContact(e,t),fetchStarredContacts:()=>f.fetchStarredContacts()}},Object.defineProperty(e,"__esModule",{value:!0})}(t,n(7117))}}]);
//# sourceMappingURL=https://d1cdksi819e9z7.cloudfront.net/sourcemap/pwa-webim.js-70ba3ef5b17377f58856.map